---
title: "[Flutter/Dart] Freezed 3.0 ãŒãƒªãƒªãƒ¼ã‚¹ï¼ 2.x ã‹ã‚‰ã®ä¸»è¦ãªå¤‰æ›´ç‚¹ã¾ã¨ã‚"
emoji: "ğŸ§Š"
type: "tech" 
topics: ["Flutter", "Dart", "Freezed"]
published: false
---

æœ€è¿‘(ã¨ã„ã£ã¦ã‚‚2ãƒ¶æœˆä½å‰ã£ã½ã„)ãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸ Freezed 3.0 ã«ã¤ã„ã¦ã€ 2.x ã‹ã‚‰ã®æ›´æ–°ä½œæ¥­ã«ã‚ãŸã£ã¦ä¸»è¦ãªå¤‰æ›´ç‚¹ã‚’èª¿ã¹ã¦ã¾ã¨ã‚ã¾ã—ãŸã€‚


# ç ´å£Šçš„å¤‰æ›´

## `sealed` ã¾ãŸã¯ `abstract` ã®å¿…é ˆåŒ–

`factory` ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’ç”¨ã„ã‚‹ã‚¯ãƒ©ã‚¹ã«ã¯ `abstract` (å˜ä¸€ã‚¯ãƒ©ã‚¹ã®å ´åˆ) ã¾ãŸã¯ `sealed` (ç›´å’Œå‹(Union)ã®å ´åˆ) ãŒå¿…è¦ã«ãªã‚Šã¾ã—ãŸã€‚

```diff dart
@freezed
-class Person with _$Person {
+abstract class Person with _$Person {
  const factory Person({
    required String firstName,
    required String lastName,
    required int age,
  }) = _Person;

  factory Person.fromJson(Map<String, Object?> json)
      => _$PersonFromJson(json);
}
```

```diff dart
@freezed
-class Model with _$Model {
+sealed class Model with _$Model {
  factory Model.first(String a) = First;
  factory Model.second(int b, bool c) = Second;
}
```

## `map` `when` ã¨ã€ãã®æ´¾ç”Ÿãƒ¡ã‚½ãƒƒãƒ‰ãŒå‰Šé™¤

Dart ã«ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ãŒå°å…¥ã•ã‚ŒãŸã“ã¨ã«ã‚ˆã‚Šéæ¨å¥¨ã¨ãªã£ã¦ã„ãŸ `map` ã‚„ `when` ãªã©ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚

### è§£æ±ºç­–

Dart ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã‚’ç”¨ã„ã‚‹ã‚ˆã†ã«æ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚

```diff dart
final model = Model.first('42');

-final res = model.map(
-  first: (String a) => 'first $a',
-  second: (int b, bool c) => 'second $b $c',
-);
+final res = switch (model) {
+  First(:final a) => 'first $a',
+  Second(:final b, :final c) => 'second $b $c',
+};
```


# æ–°è¦è¦ç´ 

## Mixed mode

`mixed mode` ã¨ã„ã†å®šç¾©æ–¹æ³•ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

å¾“æ¥ã® `factory` ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’ç”¨ã„ãŸå®šç¾©æ–¹æ³•ã§ã¯ã€ Freezed ãŒã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã—ãŸã€‚
`mixed mode` ã§ã¯ã€ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯é–‹ç™ºè€…ãŒå®šç¾©ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### ã“ã‚Œã¾ã§ã®å®šç¾©ã®ä»•æ–¹ (Factory ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿)

```dart
@freezed
sealed class Usual with _$Usual {
  // Freezed ãŒã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ç”Ÿæˆ
  factory Usual({int? a}) = _Usual;
}
```

### 3.0 ã‹ã‚‰ã§ãã‚‹æ›¸ãæ–¹ (é€šå¸¸ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿)

```dart
@freezed
class Usual with _$Usual {
  // é–‹ç™ºè€…ãŒã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¨ final ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å®šç¾©
  Usual({this.a});
  final int? a;
}
```

ã“ã‚Œã«ã¯ã„ãã¤ã‹ã®ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã£ã¦ã€

- ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹ã§ã‚ã‚Œã°ã€(ã€ŒFreeezed ã—ãã•ã€ãª) `factory` ã‚’ä½¿ã‚ãšã«é€šå¸¸ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å®šç¾©ã§ãã¾ã™ã€‚
- ç›´å’Œå‹(Union)ã¯ã“ã‚Œã¾ã§ã©ãŠã‚Š `factory` ã‚’åˆ©ç”¨ã—ã¦å®šç¾©ã§ãã¾ã™ã€‚

ã¾ãŸã€ã“ã® `mixed mode` ã«ã‚ˆã‚Šã€é€šå¸¸ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãŒåˆ©ç”¨å¯èƒ½ã«ãªã£ãŸã“ã¨ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ãª `super` ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®å‘¼ã³å‡ºã—ã‚‚å¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚

```dart
class Base {
  Base(String value);
}

@freezed
class Usual extends Base with _$Usual {
  // é€šå¸¸ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§ super ã‚’å‘¼ã³å‡ºã™
  Usual({int? a}) : a = a ?? 0, super('value');
  final int a;
}
```


## Inheritance and non-constant default values (ç¶™æ‰¿ã¨éå®šæ•°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤)

å¾“æ¥ã® Freezed ã§ã¯ã‚¯ãƒ©ã‚¹ã®ç¶™æ‰¿ (`extends`) ã‚„ã€ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿å¼•æ•°ã«å¯¾ã™ã‚‹éå®šæ•° (`const` ã§ãªã„) ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®è¨­å®šã«åˆ¶é™ãŒã‚ã‚Šã¾ã—ãŸã€‚
Freezed 3.0 ã§ã¯ã€`mixed mode` ã¨ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ (`ã‚¯ãƒ©ã‚¹å._()`) ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€ã“ã‚Œã‚‰ã®æ©Ÿèƒ½ãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚

å¾“æ¥ã€Freezed ã‚¯ãƒ©ã‚¹ã«ç‹¬è‡ªã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å®šç¾©ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ç©ºã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ `ã‚¯ãƒ©ã‚¹å._();` ã‚’å®šç¾©ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚
ã—ã‹ã—ã€ã“ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ `._()` ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¸¡ã™ã“ã¨ã¯ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚

```dart
@freezed
class Example with _$Example {
  Example._(); // helloWorld() ãŒå‹•ä½œã™ã‚‹ãŸã‚ã«å¿…è¦

  factory Example(String name) = _Example;

  void helloWorld() => print('Hello $name');
}
```


Freezed 3.0 ã§ã¯ã€ã“ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«ä»»æ„ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¸¡ã™ã“ã¨ãŒã§ãã¾ã™ã€‚Freezed ã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åã«åŸºã¥ã„ã¦ã€ä»–ã® `factory` ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‹ã‚‰å€¤ã‚’å—ã‘æ¸¡ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€`super` ã®å‘¼ã³å‡ºã—ã‚„éå®šæ•°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®è¨­å®šãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

**ç¶™æ‰¿ (`extends`) ã®ä¾‹:**

```dart
class Subclass {
  Subclass.name(this.value);
  final int value;
}

@freezed
class MyFreezedClass extends Subclass with _$MyFreezedClass {
  // ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ ._ ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Šã€
  // super.name() ã‚’å‘¼ã³å‡ºã—ã¦åŸºåº•ã‚¯ãƒ©ã‚¹ (Subclass) ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«å€¤ã‚’æ¸¡ã™
  MyFreezedClass._(super.value): super.name();

  // Freezed ã¯ value ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ MyFreezedClass._ ã«æ¸¡ã™ã‚ˆã†ã«ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã™ã‚‹
  factory MyFreezedClass(int value, /* other fields */) = _MyFreezedClass;
}
```

ä»¥ä¸‹ã®ã‚ˆã†ã«ã€å®šæ•°ã§ãªã„ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚‚åˆ©ç”¨ã§ãã¾ã™ã€‚

```dart
@freezed
sealed class Response<T> with _$Response<T> {
  // ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ ._ å†…ã§ã€time ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«éå®šæ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ DateTime.now() ã‚’è¨­å®š
  Response._({DateTime? time}) : time = time ?? DateTime.now();

  // å„ factory ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¯ã€å¿…è¦ã«å¿œã˜ã¦ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ ._() ã«å€¤ã‚’æ¸¡ã›ã‚‹
  // time ã‚’æŒ‡å®šã—ãªã„å ´åˆã€._() å†…ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒä½¿ã‚ã‚Œã‚‹
  factory Response.data(T value, {DateTime? time}) = ResponseData;

  // ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ ._() ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒåå‰ä»˜ãã§ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãªå ´åˆ ({DateTime? time})ã€
  // factory ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§æ˜ç¤ºçš„ã«æŒ‡å®šã—ãªã„é™ã‚Šã€._() å†…ã§è¨­å®šã•ã‚ŒãŸãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒä½¿ç”¨ã•ã‚Œã‚‹
  factory Response.error(Object error) = ResponseError;

  @override
  final DateTime time;
}
```


## "Eject" union cases (ç‰¹å®šã® Union ã‚±ãƒ¼ã‚¹ã®åˆ†é›¢)

ç›´å’Œå‹ (Union types) ã®ç‰¹å®šã®ã‚±ãƒ¼ã‚¹ã«ã¤ã„ã¦ã€Freezed ã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’è¡Œã‚ãšã€ç‹¬è‡ªã«å®šç¾©ã—ãŸã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```dart
@freezed
sealed class Result<T> with _$Result {
  Result._();

  // ResultData ã¯æœªå®šç¾©ãªã®ã§ã€å¾“æ¥é€šã‚Š Freezed ãŒè‡ªå‹•ç”Ÿæˆã—ã¾ã™
  factory Result.data(T data) = ResultData;

  // å³è¾ºã«æ—¢å­˜ã®ã‚¯ãƒ©ã‚¹å (ResultError) ã‚’æŒ‡å®šã™ã‚‹ã¨ã€Freezed ã¯
  // ãã®ã‚±ãƒ¼ã‚¹ (ResultError) ã®ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’è¡Œã‚ãšã€æŒ‡å®šã•ã‚ŒãŸã‚¯ãƒ©ã‚¹ã‚’ãã®ã¾ã¾åˆ©ç”¨ã—ã¾ã™
  factory Result.error(Object error) = ResultError;
}

// ç‹¬è‡ªã«å®šç¾©ã—ãŸ ResultError ã‚¯ãƒ©ã‚¹
// sealed ã‚¯ãƒ©ã‚¹ã§ã‚ã‚‹ Result<T> ã‚’ extends ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
class ResultError<T> extends Result<T> {
  ResultError(this.error): super._();
  final Object error;
}
```

ã“ã®ç‹¬è‡ªå®šç¾©ã‚¯ãƒ©ã‚¹ (`ResultError`) ã‚‚ Freezed ã‚¯ãƒ©ã‚¹ã«ã™ã‚‹ã“ã¨ãŒã§ãã€å‰è¿°ã® `mixed mode` ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```dart
// mixed mode ã‚’ç”¨ã„ãŸã‚·ãƒ³ãƒ—ãƒ«ãªã‚¯ãƒ©ã‚¹
@freezed
class ResultError<T> extends Result<T> with _$ResultError<T> {
  ResultError(this.error): super._();
  final Object error;
}

// ã¾ãŸã¯ã€ factory ã‚’ç”¨ã„ã‚‹æ›¸ãæ–¹ã‚‚å¯èƒ½
@freezed
abstract class ResultError<T> extends Result<T> with _$ResultError<T> {
  ResultError._(): super._();
  factory ResultError(Object error) = _ResultError;
}
```

:::message
ç‹¬è‡ªå®šç¾©ã™ã‚‹ã‚¯ãƒ©ã‚¹ (`ResultError`) ã¯è¦ªã‚¯ãƒ©ã‚¹ `Result` ç¶™æ‰¿ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã‚Œã¯ã€Dart ã® `sealed` ä¿®é£¾å­ãŒ `mixin` ã«ã¯é©ç”¨ã§ããšã€`implements` ã‚’ä½¿ã£ã¦ `sealed` ã‚¯ãƒ©ã‚¹ã®åˆ¶ç´„ã‚’æº€ãŸã™ã“ã¨ãŒã§ããªã„ãŸã‚ã§ã™ã€‚
:::


# ãã®ä»–ã®å¤‰æ›´

## `// dart format off` ã®è‡ªå‹•æŒ¿å…¥

Freezed ã®è¨­å®šã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒç„¡åŠ¹ (`format: false`ã€ã“ã‚ŒãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ) ã®å ´åˆã€ç”Ÿæˆã•ã‚Œã‚‹ `.freezed.dart` ãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­ã« `// dart format off` ãŒä»˜ä¸ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ CI ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ã‹ã‚‰é™¤å¤–ã™ã‚‹è¨­å®šãŒä¸è¦ã«ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

## Union ã‚±ãƒ¼ã‚¹ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆåŒ–

ç›´å’Œå‹ (Union types) ã®å„ã‚±ãƒ¼ã‚¹ã«å¯¾å¿œã™ã‚‹ `factory` ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ (`_`) ã«ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```dart
@freezed
sealed class Result<T> with _$Result {
  // ã“ã® ._data() ã¯ 3.0 ã‹ã‚‰æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã£ãŸ
  factory Result._data(T data) = ResultData; 
  factory Result.error(Object error) = ResultError;
}
```

# å‚è€ƒè³‡æ–™

- https://github.com/rrousselGit/freezed/blob/master/packages/freezed/CHANGELOG.md#300---2025-02-25
- https://github.com/rrousselGit/freezed/blob/master/packages/freezed/migration_guide.md
